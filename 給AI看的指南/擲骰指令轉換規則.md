# 擲骰指令轉換規則

本文件旨在說明如何在劇情文本中，根據擲骰事件的類型與結果，正確地插入指令以給予玩家獎勵。

## 擲骰類型

遊戲中的擲骰主要分為以下兩種：

1.  **系統擲骰 (自動檢定)**:
    *   此類擲骰由系統自動觸發並完成檢定。
    *   檢定結果（成功/失敗）會直接通過「即時訊息區」告知玩家。
    *   **指令範例**: `BeginDiceRoll(Auto,FeatID,難度);` (此處 `FeatID` 需替換為實際檢定的屬性或專長ID，例如 `InsightCheck` 代表洞悉檢定。)

2.  **手動擲骰 (選項回應)**:
    *   此類擲骰通常與玩家的對話選項相關聯。
    *   玩家選擇帶有檢定需求的選項後，系統進行檢定。
    *   檢定結果會導向不同的對話分支或劇情發展（成功分支/失敗分支）。
    *   **重要**: 為了確保手動擲骰指令能正確觸發，需要在包含檢定選項的對話**之前**，插入一個特殊的「空對話」步驟。這個空對話僅用於放置 `BeginDiceRoll` 指令，其JSON格式應不包含任何可見的對話文字。
    *   **指令範例**:
        1.  **前置空對話指令**: 在玩家即將看到帶有檢定選項的對話之前，插入一個空對話來觸發擲骰。例如，若接下來的選項有一個魅力檢定，難度為6，則插入以下JSON結構的對話：
            ```json
            {
                "talker": "", // 系統指令，無發言者
                "content": "", // 無對話內容
                "command": "BeginDiceRoll(Manual,CharismaCheck,6);" // 執行魅力檢定
            }
            ```
        2.  **對話選項標註**: 接著，在玩家的對話選項中正常標註檢定信息，例如：`1.  [魅力 難度6]：「三百文？小意思！」`。遊戲系統會將此選項與先前 `BeginDiceRoll` 指令的結果相關聯。

## 檢定成功獎勵規則

無論是系統擲骰還是手動擲骰，只要檢定成功，都應在「即時訊息區」給予玩家相應的經驗值獎勵。

*   **通用獎勵標準**: 檢定成功，對應的「五維屬性」或「專長」經驗值 **+10**。

*   **指令格式**:
    *   **五維經驗值**: `ModifyData(AbilityExp,MC1,AbilityID,10);`
        *   `MC1`: 通常代表主角ID。
        *   `AbilityID`: 對應的五維屬性ID。根據最新列表，這些ID格式為 `Ability_XXX` (例如：武力對應 `Ability_STR`，魅力對應 `Ability_CHA`)。
        *   **注意**: `StrengthCheck`, `CharismaCheck` 等是檢定本身的標籤ID。獎勵五維經驗時，應使用實際的五維屬性ID，如 `Ability_STR`, `Ability_INT`, `Ability_POL`, `Ability_CHA`, `Ability_LDR`。 例如，魅力檢定成功，應獎勵 `Ability_CHA` 經驗。
    *   **專長經驗值**: `ModifyData(FeatExp,MC1,FeatID,10);`
        *   `MC1`: 通常代表主角ID。
        *   `FeatID`: 對應的專長ID，參考 `異麒麟所有ID命名.xlsx - 特殊標籤(職骰).csv` (例如：醫術檢定 `MedicalExpertiseCheck` 對應的專長ID為 `MedicalExpertise`，經濟檢定 `EconomicDevelopmentCheck` 對應的專長ID為 `EconomicDevelopment`)。
        *   **注意**: 同樣地，獎勵專長經驗時，應使用專長本身的ID。

### 常用檢定項目ID對照
以下表格列出了常用的檢定項目、用於擲骰指令的ID (`BeginDiceRoll` 中的 `FeatID`)，以及檢定成功後用於獎勵指令的ID (`ModifyData` 中的 `AbilityID` 或 `FeatID`)，與獎勵類型 (`ModifyData` 指令)。

| 檢定名稱 (Check Name)        | 檢定用ID (`BeginDiceRoll` 中的 `FeatID`) | 獎勵用ID (`ModifyData` ID) | 獎勵類型 (`ModifyData` 指令) |
|---------------------------|-------------------------------------------|-----------------------------|------------------------------|
| 統率檢定                  | `LeadershipCheck`                         | `Ability_LDR`               | 五維 (`AbilityExp`)          |
| 武力檢定                  | `StrengthCheck`                           | `Ability_STR`               | 五維 (`AbilityExp`)          |
| 智力檢定                  | `IntelligenceCheck`                       | `Ability_INT`               | 五維 (`AbilityExp`)          |
| 政治檢定                  | `PoliticsCheck`                           | `Ability_POL`               | 五維 (`AbilityExp`)          |
| 魅力檢定                  | `CharismaCheck`                           | `Ability_CHA`               | 五維 (`AbilityExp`)          |
| 步兵檢定                  | `InfantryCheck`                           | `Infantry`                  | 專長 (`FeatExp`)             |
| 兵法檢定                  | `MilitaryTacticsCheck`                    | `MilitaryTactics`           | 專長 (`FeatExp`)             |
| 弓術檢定                  | `ArcheryCheck`                            | `Archery`                   | 專長 (`FeatExp`)             |
| 武藝檢定                  | `MartialArtsCheck`                        | `MartialArts`               | 專長 (`FeatExp`)             |
| 內功檢定                  | `QiCheck`                                 | `Qi`                        | 專長 (`FeatExp`)             |
| 騎術檢定                  | `HorsemanshipCheck`                       | `Horsemanship`              | 專長 (`FeatExp`)             |
| 威嚇檢定                  | `IntimidationCheck`                       | `Intimidation`              | 專長 (`FeatExp`)             |
| 洞悉檢定                  | `InsightCheck`                            | `Insight`                   | 專長 (`FeatExp`)             |
| 謀略檢定                  | `StrategyCheck`                           | `Strategy`                  | 專長 (`FeatExp`)             |
| 學識檢定                  | `KnowledgeCheck`                          | `Knowledge`                 | 專長 (`FeatExp`)             |
| 醫術檢定                  | `MedicalExpertiseCheck`                   | `MedicalExpertise`          | 專長 (`FeatExp`)             |
| 厚黑檢定                  | `RealpolitikCheck`                        | `Realpolitik`               | 專長 (`FeatExp`)             |
| 經濟檢定                  | `EconomicDevelopmentCheck`                | `EconomicDevelopment`       | 專長 (`FeatExp`)             |
| 口才檢定                  | `PersuasionCheck`                         | `Persuasion`                | 專長 (`FeatExp`)             |
| 調情檢定                  | `FlirtingCheck`                           | `Flirting`                  | 專長 (`FeatExp`)             |
| 酒量檢定                  | `AlcoholToleranceCheck`                   | `AlcoholTolerance`          | 專長 (`FeatExp`)             |
| 巧手檢定                  | `SleightOfHandCheck`                      | `SleightOfHand`             | 專長 (`FeatExp`)             |
| 奪寶檢定                  | `TreasureHuntingCheck`                    | `TreasureHunting`           | 專長 (`FeatExp`)             |

*   **獎勵指令插入時機**:
    *   **系統擲骰**: 在旁白或系統訊息描述檢定成功後，緊接著插入獎勵指令。
    *   **手動擲骰**: 在進入檢定成功的對話分支或劇情流程後，盡快插入獎勵指令，通常在NPC回應檢定成功的玩家選擇之後，或是在該成功分支的起始旁白中。

## 範例

**情境1: 系統自動洞悉檢定成功**

```
**(若洞悉檢定成功)**
    **旁白:**：
    [panel=5]＊（你注意到老伯在說出價格時，眼神似乎閃爍了一下，嘴角有著一絲不易察覺的弧度，似乎這價格並非表面那般簡單。）＊
    **[即時訊息區]**: 洞悉檢定成功！洞悉經驗+10。
    ModifyData(FeatExp,MC1,Insight,10);
    **玩家**（選擇回應）：
    ...
```

**情境2: 手動魅力檢定成功 (對話選項)**

假設在玩家看到以下選項前，已執行了對應的擲骰指令：
```json
{
    "talker": "",
    "content": "",
    "command": "BeginDiceRoll(Manual,CharismaCheck,6);"
}
```

```
**(若魅力檢定 難度6 成功)**
    **茶攤老伯:** ：「哦？小哥兒口氣不小啊。最好的雨前龍井五十文一壺，點心嘛…只有些粗餅，就算送你們的添頭了。」
    **[即時訊息區]**: 魅力檢定成功！魅力經驗+10。
    ModifyData(AbilityExp,MC1,Ability_CHA,10);
    **蕭靈犀:** `[癟嘴立繪]`：「表哥你又打腫臉充胖子…我們哪有錢…」
    ...
```